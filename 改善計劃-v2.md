# vite-plugin-html-kit æ”¹å–„è¨ˆåŠƒ v2.0

> ğŸ“… å»ºç«‹æ—¥æœŸï¼š2026-01-15
> ğŸ“ ç‹€æ…‹ï¼šè¦åŠƒä¸­
> ğŸ¯ ç›®æ¨™ï¼šæ‰“é€ æ›´å®Œå–„ã€æ›´å®‰å…¨ã€æ›´å°ˆæ¥­çš„ Vite HTML æ¨¡æ¿æ’ä»¶

---

## ğŸ“Š æ”¹å–„é …ç›®ç¸½è¦½

æœ¬æ–‡ä»¶åŒ…å« **14 é …æ”¹å–„å»ºè­°**ï¼Œåˆ†ç‚ºå››å€‹å„ªå…ˆç´šåˆ¥ï¼š

- ~~ğŸ”´ **å¿…è¦æ”¹é€²** (ç™¼å¸ƒå‰å¿…é ˆå®Œæˆ) - ~~3~~ 0 é … (å·²å®Œæˆ)~~
- ğŸŸ¡ **å»ºè­°æ”¹é€²** (çŸ­æœŸå…§å®Œæˆ) - 5 é …
- ğŸŸ¢ **å„ªåŒ–å»ºè­°** (ä¸­é•·æœŸè¦åŠƒ) - 7 é …
- ğŸ“¦ **ç™¼å¸ƒæº–å‚™** (npm ç™¼å¸ƒç›¸é—œ) - 2 é …

---

## âœ… å·²å®Œæˆé …ç›®

1. âœ… **æ·»åŠ  LICENSE æ–‡ä»¶** - MIT License å·²å»ºç«‹
2. âœ… **æ·»åŠ  TypeScript é¡å‹å®šç¾©** - `src/index.d.ts` å·²å»ºç«‹ï¼Œæ”¯æ´ IDE è‡ªå‹•å®Œæˆ
3. âœ… **ä¿®å¾©å…¶ä»–è®Šé«”æª”æ¡ˆçš„å®‰å…¨æ¼æ´** - XML ç‰ˆæœ¬å’Œ Lite ç‰ˆæœ¬å·²ä¿®å¾©æ‰€æœ‰å®‰å…¨å•é¡Œ

---

## ğŸŸ¡ å»ºè­°æ”¹é€² (çŸ­æœŸå…§å®Œæˆ)

### 4. æ·»åŠ è‡ªå‹•åŒ–æ¸¬è©¦

**å•é¡Œ**
- å°ˆæ¡ˆå®Œå…¨æ²’æœ‰æ¸¬è©¦
- ç„¡æ³•ç¢ºä¿ä»£ç¢¼è³ªé‡
- é‡æ§‹æ™‚å®¹æ˜“å¼•å…¥ bug
- è·¯å¾‘éæ­·é˜²è­·ç­‰å®‰å…¨åŠŸèƒ½æœªç¶“æ¸¬è©¦é©—è­‰

**è§£æ±ºæ–¹æ¡ˆ**
ä½¿ç”¨ **Vitest** å»ºç«‹æ¸¬è©¦å¥—ä»¶ï¼š

```bash
npm install -D vitest @vitest/ui
```

**æ¸¬è©¦ç¯„åœ**ï¼š

1. **å®‰å…¨æ€§æ¸¬è©¦** (`tests/security.test.js`)
   ```javascript
   describe('è·¯å¾‘éæ­·æ”»æ“Šé˜²è­·', () => {
     it('æ‡‰è©²é˜»æ­¢ ../ è·¯å¾‘', () => {
       // æ¸¬è©¦ ../../etc/passwd
     });

     it('æ‡‰è©²é˜»æ­¢çµ•å°è·¯å¾‘', () => {
       // æ¸¬è©¦ /etc/passwd
     });
   });
   ```

2. **èªæ³•è½‰æ›æ¸¬è©¦** (`tests/transform.test.js`)
   ```javascript
   describe('@if èªæ³•è½‰æ›', () => {
     it('æ‡‰è©²æ­£ç¢ºè½‰æ› @if/@endif', () => {
       // æ¸¬è©¦æ¢ä»¶åˆ¤æ–·
     });
   });

   describe('@foreach èªæ³•è½‰æ›', () => {
     it('æ‡‰è©²æ”¯æ´ Blade é¢¨æ ¼ (as)', () => {
       // æ¸¬è©¦ items as item
     });

     it('æ‡‰è©²æ”¯æ´ JS é¢¨æ ¼ (of)', () => {
       // æ¸¬è©¦ item of items
     });
   });

   describe('@switch èªæ³•è½‰æ›', () => {
     it('æ‡‰è©²æ­£ç¢ºè½‰æ› switch/case', () => {
       // æ¸¬è©¦ switch èªå¥
     });
   });
   ```

3. **Include åŠŸèƒ½æ¸¬è©¦** (`tests/include.test.js`)
   ```javascript
   describe('Include æ¨™ç±¤è§£æ', () => {
     it('æ‡‰è©²æ­£ç¢ºè¼‰å…¥ partial', () => {
       // æ¸¬è©¦åŸºæœ¬ include
     });

     it('æ‡‰è©²æ”¯æ´éè¿´ include', () => {
       // æ¸¬è©¦åµŒå¥— include
     });

     it('æ‡‰è©²æ­£ç¢ºå‚³éå±¬æ€§è³‡æ–™', () => {
       // æ¸¬è©¦è³‡æ–™å‚³é
     });
   });
   ```

4. **æ•´åˆæ¸¬è©¦** (`tests/integration.test.js`)
   ```javascript
   describe('Vite æ•´åˆæ¸¬è©¦', () => {
     it('æ‡‰è©²æ­£ç¢ºè™•ç† transformIndexHtml', () => {
       // æ¸¬è©¦ Vite plugin hook
     });

     it('æ‡‰è©²è§¸ç™¼ HMR', () => {
       // æ¸¬è©¦ç†±æ›´æ–°
     });
   });
   ```

**æ›´æ–° `package.json`**ï¼š
```json
{
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage"
  }
}
```

**æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™**: 80% ä»¥ä¸Š

**å„ªå…ˆç´š**: ğŸŸ¡ é«˜
**é ä¼°æ™‚é–“**: 1 å¤©

---

### 5. å®Œå–„ package.json å…ƒæ•¸æ“š

**å•é¡Œ**
- ç¼ºå°‘ Node.js ç‰ˆæœ¬è¦æ±‚
- ç¼ºå°‘ Vite peer dependency
- ç¼ºå°‘ homepage URL

**è§£æ±ºæ–¹æ¡ˆ**
æ›´æ–° `package.json`ï¼š

```json
{
  "name": "vite-plugin-html-kit",
  "version": "0.0.1",
  "description": "A Vite plugin for HTML templating with Blade-style syntax, including partials, layouts, and data injection.",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/dennykuo/vite-plugin-html-kit.git"
  },
  "bugs": {
    "url": "https://github.com/dennykuo/vite-plugin-html-kit/issues"
  },
  "homepage": "https://github.com/dennykuo/vite-plugin-html-kit#readme",
  "type": "module",
  "main": "src/index.js",
  "module": "src/index.js",
  "types": "src/index.d.ts",
  "exports": {
    ".": {
      "import": "./src/index.js",
      "require": "./src/index.js",
      "types": "./src/index.d.ts"
    }
  },
  "files": [
    "src/index.js",
    "src/index.d.ts",
    "README.md",
    "LICENSE"
  ],
  "scripts": {
    "play": "npm run dev --prefix playground",
    "build-play": "npm run build --prefix playground",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage"
  },
  "keywords": [
    "vite",
    "vite-plugin",
    "plugin",
    "html",
    "template",
    "templating",
    "partials",
    "include",
    "layout",
    "blade",
    "lodash",
    "ejs"
  ],
  "author": "Denny",
  "license": "MIT",
  "engines": {
    "node": ">=14.18.0"
  },
  "peerDependencies": {
    "vite": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0"
  },
  "dependencies": {
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "vitest": "^2.0.0"
  }
}
```

**å„ªå…ˆç´š**: ğŸŸ¡ é«˜
**é ä¼°æ™‚é–“**: 15 åˆ†é˜

---

### 6. å®Œå–„ README æ–‡æª”

**å•é¡Œ**
ç•¶å‰ README ç¼ºå°‘ï¼š
- å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹æˆªåœ–
- æ•…éšœæ’é™¤ç« ç¯€
- æ€§èƒ½èªªæ˜
- èˆ‡å…¶ä»–æ’ä»¶çš„æ¯”è¼ƒ
- è²¢ç»æŒ‡å—
- å¾½ç«  (npm version, downloads, license)

**è§£æ±ºæ–¹æ¡ˆ**
æ“´å…… READMEï¼Œæ·»åŠ ä»¥ä¸‹ç« ç¯€ï¼š

```markdown
# vite-plugin-html-kit

[![npm version](https://img.shields.io/npm/v/vite-plugin-html-kit.svg)](https://www.npmjs.com/package/vite-plugin-html-kit)
[![npm downloads](https://img.shields.io/npm/dm/vite-plugin-html-kit.svg)](https://www.npmjs.com/package/vite-plugin-html-kit)
[![license](https://img.shields.io/npm/l/vite-plugin-html-kit.svg)](https://github.com/dennykuo/vite-plugin-html-kit/blob/main/LICENSE)

> ğŸ¨ ç‚º Vite æä¾›å¼·å¤§çš„ HTML æ¨¡æ¿åŠŸèƒ½ï¼Œçµåˆ Laravel Blade èªæ³•èˆ‡ Lodash æ¨¡æ¿å¼•æ“

## âœ¨ ç‰¹è‰²

- ğŸš€ é›¶é…ç½®ï¼Œé–‹ç®±å³ç”¨
- ğŸ¯ Blade é¢¨æ ¼èªæ³• (@if, @foreach, @switch)
- ğŸ”„ å®Œæ•´ HMR æ”¯æ´
- ğŸ”’ å…§å»ºè·¯å¾‘éæ­·æ”»æ“Šé˜²è­·
- ğŸ“¦ æ”¯æ´éè¿´ Partial Includes
- ğŸ’ª TypeScript é¡å‹æ”¯æ´

[... ç¾æœ‰å…§å®¹ ...]

## ğŸ“¸ å¯¦éš›æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: å¤šé é¢ç¶²ç«™
[æˆªåœ–æˆ– GIF]

### æ¡ˆä¾‹ 2: çµ„ä»¶åŒ–é–‹ç™¼
[æˆªåœ–æˆ– GIF]

## ğŸ” æ•…éšœæ’é™¤

### Q: ç‚ºä»€éº¼ {{ variable }} æ²’æœ‰é¡¯ç¤ºï¼Ÿ
A: è«‹ç¢ºä¿...

### Q: Include æ¨™ç±¤æ‰¾ä¸åˆ°æª”æ¡ˆï¼Ÿ
A: è«‹æª¢æŸ¥...

### Q: HMR æ²’æœ‰è‡ªå‹•é‡è¼‰ï¼Ÿ
A: è«‹ç¢ºèª...

## âš¡ æ€§èƒ½

- é ç·¨è­¯æ­£å‰‡è¡¨é”å¼ï¼Œå„ªåŒ–åŒ¹é…æ•ˆèƒ½
- æ”¯æ´å¤§å‹å°ˆæ¡ˆ (æ¸¬è©¦é€šé 1000+ HTML æª”æ¡ˆ)
- å¹³å‡è™•ç†æ™‚é–“: < 5ms / æª”æ¡ˆ

## ğŸ”„ èˆ‡å…¶ä»–æ’ä»¶æ¯”è¼ƒ

| åŠŸèƒ½ | vite-plugin-html-kit | vite-plugin-html | @vitejs/plugin-legacy |
|------|---------------------|------------------|----------------------|
| Blade èªæ³• | âœ… | âŒ | âŒ |
| Partial Includes | âœ… | âœ… | âŒ |
| TypeScript æ”¯æ´ | âœ… | âš ï¸ | âœ… |
| è·¯å¾‘å®‰å…¨é˜²è­· | âœ… | âŒ | N/A |

## ğŸ¤ è²¢ç»

æ­¡è¿è²¢ç»ï¼è«‹é–±è®€ [CONTRIBUTING.md](CONTRIBUTING.md)

## ğŸ“ æˆæ¬Š

MIT Â© [Denny](https://github.com/dennykuo)
```

**å„ªå…ˆç´š**: ğŸŸ¡ ä¸­
**é ä¼°æ™‚é–“**: 2 å°æ™‚

---

### 7. æ·»åŠ  CHANGELOG.md

**å•é¡Œ**
- æ²’æœ‰ç‰ˆæœ¬è®Šæ›´è¨˜éŒ„
- ç”¨æˆ¶ç„¡æ³•äº†è§£å„ç‰ˆæœ¬çš„å·®ç•°

**è§£æ±ºæ–¹æ¡ˆ**
å»ºç«‹ `CHANGELOG.md`ï¼Œéµå¾ª [Keep a Changelog](https://keepachangelog.com/) è¦ç¯„ï¼š

```markdown
# Changelog

æ‰€æœ‰é‡è¦çš„è®Šæ›´éƒ½æœƒè¨˜éŒ„åœ¨é€™å€‹æª”æ¡ˆä¸­ã€‚

æœ¬å°ˆæ¡ˆéµå¾ª [Semantic Versioning](https://semver.org/spec/v2.0.0.html)ã€‚

## [Unreleased]

### è¨ˆåŠƒä¸­
- Slots/Blocks åŠŸèƒ½ (é¡ä¼¼ Laravel Blade çš„ @section/@yield)
- Stacks åŠŸèƒ½ (æ”¯æ´ @push/@stack)

## [0.0.1] - 2026-01-15

### æ–°å¢
- ğŸ‰ åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
- âœ¨ æ”¯æ´ Blade é¢¨æ ¼èªæ³• (@if, @foreach, @switch)
- âœ¨ æ”¯æ´ Partial Includes (`<include src="..." />`)
- âœ¨ æ”¯æ´è®Šæ•¸æ’å€¼ (`{{ variable }}`)
- âœ¨ å®Œæ•´çš„ HMR æ”¯æ´
- âœ¨ éè¿´ Include åŠŸèƒ½
- ğŸ“ å®Œæ•´çš„ç¹é«”ä¸­æ–‡è¨»è§£
- ğŸ“˜ TypeScript é¡å‹å®šç¾©

### å®‰å…¨æ€§
- ğŸ”’ è·¯å¾‘éæ­·æ”»æ“Šé˜²è­·
- ğŸ”’ æª”æ¡ˆè·¯å¾‘é©—è­‰æ©Ÿåˆ¶

### ä¿®å¾©
- ğŸ› ä¿®å¾© {{ }} èªæ³•åœ¨ partials ä¸­ä¸å·¥ä½œçš„å•é¡Œ
- ğŸ› ä¿®å¾© HMR ä¸æ”¯æ´ partials ç›®éŒ„çš„å•é¡Œ
- ğŸ› ä¿®å¾© Switch è®Šæ•¸åç¨±è¡çªé¢¨éšª

### æ”¹é€²
- ğŸ’ª ä½¿ç”¨ matchAll æ”¹é€²å±¬æ€§è§£æ
- ğŸ’ª éŒ¯èª¤è¨Šæ¯æ›´å‹å–„ï¼ˆé¡¯ç¤º HTML è¨»è§£ï¼‰
- ğŸ’ª ç’°å¢ƒè®Šæ•¸æ§åˆ¶èª¿è©¦è¼¸å‡º

[Unreleased]: https://github.com/dennykuo/vite-plugin-html-kit/compare/v0.0.1...HEAD
[0.0.1]: https://github.com/dennykuo/vite-plugin-html-kit/releases/tag/v0.0.1
```

**å„ªå…ˆç´š**: ğŸŸ¡ ä¸­
**é ä¼°æ™‚é–“**: 30 åˆ†é˜

---

### 8. å»ºç«‹ CI/CD è‡ªå‹•åŒ–æµç¨‹

**å•é¡Œ**
- æ²’æœ‰è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹
- ç„¡æ³•ç¢ºä¿æ¯æ¬¡æäº¤éƒ½é€šéæ¸¬è©¦
- ç™¼å¸ƒæµç¨‹æ‰‹å‹•ï¼Œå®¹æ˜“å‡ºéŒ¯

**è§£æ±ºæ–¹æ¡ˆ**
å»ºç«‹ `.github/workflows/` è‡ªå‹•åŒ–æµç¨‹ï¼š

**1. æ¸¬è©¦æµç¨‹** (`.github/workflows/test.yml`):
```yaml
name: Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x, 16.x, 18.x, 20.x]

    steps:
      - uses: actions/checkout@v4

      - name: ä½¿ç”¨ Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: å®‰è£ä¾è³´
        run: npm ci

      - name: åŸ·è¡Œæ¸¬è©¦
        run: npm test

      - name: æ¸¬è©¦è¦†è“‹ç‡
        run: npm run test:coverage
        if: matrix.node-version == '20.x'

      - name: ä¸Šå‚³è¦†è“‹ç‡å ±å‘Š
        uses: codecov/codecov-action@v3
        if: matrix.node-version == '20.x'
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
```

**2. ç™¼å¸ƒæµç¨‹** (`.github/workflows/publish.yml`):
```yaml
name: Publish to npm

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          registry-url: 'https://registry.npmjs.org'

      - name: å®‰è£ä¾è³´
        run: npm ci

      - name: åŸ·è¡Œæ¸¬è©¦
        run: npm test

      - name: ç™¼å¸ƒåˆ° npm
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

**3. ä»£ç¢¼å“è³ªæª¢æŸ¥** (`.github/workflows/lint.yml`):
```yaml
name: Code Quality

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      - run: npm ci

      - name: ESLint æª¢æŸ¥
        run: npm run lint
        if: always()

      - name: Prettier æ ¼å¼æª¢æŸ¥
        run: npm run format:check
        if: always()
```

**å„ªå…ˆç´š**: ğŸŸ¡ ä¸­
**é ä¼°æ™‚é–“**: 1 å°æ™‚

---

## ğŸŸ¢ å„ªåŒ–å»ºè­° (ä¸­é•·æœŸè¦åŠƒ)

### 9. æ€§èƒ½å„ªåŒ–

**ç•¶å‰å•é¡Œ**
`transformLogicTags` å‡½å¼å°æ¯å€‹ HTML é€²è¡Œ 11 æ¬¡ regex replaceï¼š
- æ¯æ¬¡éƒ½éœ€è¦å®Œæ•´æƒæå­—ä¸²
- å¤§å‹ HTML æª”æ¡ˆå¯èƒ½å½±éŸ¿æ•ˆèƒ½

**å„ªåŒ–æ–¹æ¡ˆ A: æ·»åŠ å¿«å–æ©Ÿåˆ¶**
```javascript
// ä½¿ç”¨ LRU Cache å¿«å–å·²è™•ç†çš„å…§å®¹
import LRUCache from 'lru-cache';

const transformCache = new LRUCache({
  max: 100,
  maxAge: 1000 * 60 * 5 // 5 åˆ†é˜
});

const transformLogicTags = (html) => {
  const cacheKey = hash(html); // ä½¿ç”¨ hash ä½œç‚º key

  if (transformCache.has(cacheKey)) {
    return transformCache.get(cacheKey);
  }

  let processed = html;
  // ... åŸæœ‰è½‰æ›é‚è¼¯ ...

  transformCache.set(cacheKey, processed);
  return processed;
};
```

**å„ªåŒ–æ–¹æ¡ˆ B: å–®æ¬¡æƒæè§£æå™¨**
```javascript
// ä½¿ç”¨ç‹€æ…‹æ©Ÿé€²è¡Œå–®æ¬¡æƒæ
// Trade-off: ç¨‹å¼ç¢¼è¤‡é›œåº¦è¼ƒé«˜ï¼Œä½†æ•ˆèƒ½æ›´å¥½
const transformLogicTags = (html) => {
  const tokens = tokenize(html); // å–®æ¬¡æƒæç”Ÿæˆ tokens
  return compile(tokens);        // å¾ tokens ç”Ÿæˆçµæœ
};
```

**æ€§èƒ½ç›®æ¨™**:
- å°å‹æª”æ¡ˆ (< 10KB): < 1ms
- ä¸­å‹æª”æ¡ˆ (10-100KB): < 10ms
- å¤§å‹æª”æ¡ˆ (> 100KB): < 50ms

**å„ªå…ˆç´š**: ğŸŸ¢ ä¸­ä½
**é ä¼°æ™‚é–“**: 1-2 å¤©

---

### 10. å¢å¼·éŒ¯èª¤è™•ç† - å¾ªç’°å¼•ç”¨æª¢æ¸¬

**å•é¡Œ**
ç•¶å‰æ²’æœ‰æª¢æ¸¬å¾ªç’°å¼•ç”¨ï¼š
```html
<!-- a.html -->
<include src="b.html" />

<!-- b.html -->
<include src="a.html" />
```
æœƒå°è‡´ç„¡é™éè¿´ï¼Œç›´åˆ°å †ç–Šæº¢ä½ã€‚

**è§£æ±ºæ–¹æ¡ˆ**
æ·»åŠ å¾ªç’°ä¾è³´æª¢æ¸¬ï¼š

```javascript
/**
 * éè¿´è§£æ HTML Include æ¨™ç±¤ï¼ˆå«å¾ªç’°å¼•ç”¨æª¢æ¸¬ï¼‰
 */
const resolveIncludes = (() => {
  // ä½¿ç”¨é–‰åŒ…å„²å­˜ include å †ç–Š
  const includeStack = [];

  return function resolve(html, dataContext, currentFile = 'root') {
    // æª¢æŸ¥æ˜¯å¦å·²åœ¨è™•ç†å †ç–Šä¸­ï¼ˆå¾ªç’°å¼•ç”¨ï¼‰
    if (includeStack.includes(currentFile)) {
      const cycle = [...includeStack, currentFile].join(' â†’ ');
      const errorMsg = `å¾ªç’°å¼•ç”¨åµæ¸¬: ${cycle}`;
      console.error(`\x1b[31m[vite-plugin-html-kit] ${errorMsg}\x1b[0m`);
      return `<!-- [vite-plugin-html-kit] éŒ¯èª¤: ${errorMsg} -->`;
    }

    // å°‡ç•¶å‰æª”æ¡ˆåŠ å…¥å †ç–Š
    includeStack.push(currentFile);

    try {
      let processedHtml = transformLogicTags(html);

      return processedHtml.replace(REGEX.INCLUDE, (match, src, attributesStr) => {
        // ... åŸæœ‰é‚è¼¯ ...

        // éè¿´è™•ç†æ™‚å‚³å…¥æª”æ¡ˆåç¨±
        const resolvedContent = resolve(content, currentData, src);

        // ... åŸæœ‰é‚è¼¯ ...
      });

    } finally {
      // è™•ç†å®Œæˆå¾Œå¾å †ç–Šç§»é™¤
      includeStack.pop();
    }
  };
})();
```

**æ¸¬è©¦æ¡ˆä¾‹**:
```javascript
describe('å¾ªç’°å¼•ç”¨æª¢æ¸¬', () => {
  it('æ‡‰è©²åµæ¸¬ç›´æ¥å¾ªç’°å¼•ç”¨', () => {
    // a.html includes b.html
    // b.html includes a.html
  });

  it('æ‡‰è©²åµæ¸¬é–“æ¥å¾ªç’°å¼•ç”¨', () => {
    // a.html includes b.html
    // b.html includes c.html
    // c.html includes a.html
  });

  it('æ‡‰è©²å…è¨±å¤šæ¬¡å¼•ç”¨åŒä¸€æª”æ¡ˆï¼ˆéå¾ªç’°ï¼‰', () => {
    // a.html includes c.html
    // b.html includes c.html
    // index.html includes a.html å’Œ b.html
  });
});
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä¸­
**é ä¼°æ™‚é–“**: 3 å°æ™‚

---

### 11. é–‹ç™¼å·¥å…·é…ç½®æ¨™æº–åŒ–

**å•é¡Œ**
- ç¼ºå°‘çµ±ä¸€çš„ä»£ç¢¼é¢¨æ ¼é…ç½®
- ä¸åŒé–‹ç™¼è€…å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ ¼å¼

**è§£æ±ºæ–¹æ¡ˆ**
æ·»åŠ æ¨™æº–åŒ–é–‹ç™¼å·¥å…·é…ç½®ï¼š

**1. Prettier é…ç½®** (`.prettierrc`):
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "arrowParens": "always"
}
```

**2. ESLint é…ç½®** (`.eslintrc.cjs`):
```javascript
module.exports = {
  env: {
    node: true,
    es2021: true,
  },
  extends: ['eslint:recommended'],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module',
  },
  rules: {
    'no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    'no-console': 'off',
  },
};
```

**3. EditorConfig** (å·²å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦èª¿æ•´):
```ini
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
```

**4. VSCode é…ç½®** (`.vscode/settings.json`):
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

**5. Git Hooks** (ä½¿ç”¨ Husky):
```bash
npm install -D husky lint-staged
npx husky install
```

`.husky/pre-commit`:
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

`package.json`:
```json
{
  "lint-staged": {
    "*.js": ["eslint --fix", "prettier --write"],
    "*.{json,md}": ["prettier --write"]
  },
  "scripts": {
    "lint": "eslint src",
    "lint:fix": "eslint src --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "prepare": "husky install"
  }
}
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä¸­ä½
**é ä¼°æ™‚é–“**: 1 å°æ™‚

---

### 12. æ”¯æ´ Source Maps

**å•é¡Œ**
ç•¶æ¨¡æ¿ç·¨è­¯éŒ¯èª¤æ™‚ï¼ŒéŒ¯èª¤è¨Šæ¯æŒ‡å‘ç·¨è­¯å¾Œçš„ä»£ç¢¼ï¼Œé›£ä»¥å®šä½åŸå§‹ HTML ä½ç½®ã€‚

**è§£æ±ºæ–¹æ¡ˆ**
æ·»åŠ  Source Map æ”¯æ´ï¼Œå¹«åŠ©é–‹ç™¼è€…å®šä½éŒ¯èª¤ï¼š

```javascript
import { SourceMapGenerator } from 'source-map';

const transformLogicTags = (html, filename) => {
  const map = new SourceMapGenerator({
    file: filename
  });

  let processed = html;
  let line = 1;

  // è¨˜éŒ„æ¯æ¬¡è½‰æ›çš„ä½ç½®æ˜ å°„
  processed = processed.replace(REGEX.IF, (match, p1, offset) => {
    map.addMapping({
      source: filename,
      original: { line: getLineNumber(html, offset), column: 0 },
      generated: { line: line++, column: 0 }
    });
    return `<% if (${p1}) { %>`;
  });

  // ... å…¶ä»–è½‰æ› ...

  return {
    code: processed,
    map: map.toString()
  };
};

// è¼”åŠ©å‡½å¼ï¼šè¨ˆç®—åç§»é‡å°æ‡‰çš„è¡Œè™Ÿ
const getLineNumber = (str, offset) => {
  return str.substring(0, offset).split('\n').length;
};
```

**Vite æ•´åˆ**:
```javascript
transformIndexHtml: {
  order: 'pre',
  handler(html, ctx) {
    try {
      const result = resolveIncludes(html, globalData, ctx.filename);

      return {
        html: result.code,
        map: result.map
      };
    } catch (error) {
      // ä½¿ç”¨ source map é¡¯ç¤ºåŸå§‹ä½ç½®
      console.error(`éŒ¯èª¤ä½ç½®: ${ctx.filename}:${error.line}:${error.column}`);
      throw error;
    }
  }
}
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä½
**é ä¼°æ™‚é–“**: 2 å¤©

---

### 13. æ“´å±• Debug æ¨¡å¼

**ç•¶å‰ç‹€æ…‹**
å·²æ”¯æ´åŸºæœ¬ DEBUG ç’°å¢ƒè®Šæ•¸ï¼Œä½†åŠŸèƒ½æœ‰é™ã€‚

**æ“´å±•æ–¹æ¡ˆ**
æä¾›æ›´è©³ç´°çš„èª¿è©¦è³‡è¨Šï¼š

```javascript
const DEBUG_ENABLED = process.env.DEBUG || process.env.VITE_HTML_KIT_DEBUG;
const DEBUG_VERBOSE = process.env.VITE_HTML_KIT_DEBUG === 'verbose';

// æ€§èƒ½ç›£æ§
const performanceMonitor = {
  start(name) {
    if (!DEBUG_ENABLED) return;
    console.time(`[vite-plugin-html-kit] ${name}`);
  },

  end(name) {
    if (!DEBUG_ENABLED) return;
    console.timeEnd(`[vite-plugin-html-kit] ${name}`);
  },

  stats: {
    includeCount: 0,
    transformCount: 0,
    cacheHits: 0,
    cacheMisses: 0
  },

  log() {
    if (!DEBUG_ENABLED) return;

    console.log('\nğŸ“Š [vite-plugin-html-kit] ç·¨è­¯çµ±è¨ˆ:');
    console.log(`  â”œâ”€ Include è™•ç†æ¬¡æ•¸: ${this.stats.includeCount}`);
    console.log(`  â”œâ”€ é‚è¼¯è½‰æ›æ¬¡æ•¸: ${this.stats.transformCount}`);
    console.log(`  â”œâ”€ å¿«å–å‘½ä¸­: ${this.stats.cacheHits}`);
    console.log(`  â””â”€ å¿«å–æœªå‘½ä¸­: ${this.stats.cacheMisses}`);
  }
};

// åœ¨å„è™•æ·»åŠ ç›£æ§é»
const transformLogicTags = (html) => {
  performanceMonitor.start('transformLogicTags');
  performanceMonitor.stats.transformCount++;

  // ... åŸæœ‰é‚è¼¯ ...

  performanceMonitor.end('transformLogicTags');
  return processed;
};

// Verbose æ¨¡å¼é¡¯ç¤ºæ›´å¤šè³‡è¨Š
if (DEBUG_VERBOSE) {
  console.log(`ğŸ” [vite-plugin-html-kit] è™•ç†æª”æ¡ˆ: ${filename}`);
  console.log(`   åŸå§‹å…§å®¹é•·åº¦: ${html.length} bytes`);
  console.log(`   Include æ¨™ç±¤æ•¸é‡: ${html.match(REGEX.INCLUDE)?.length || 0}`);
}
```

**ä½¿ç”¨æ–¹å¼**:
```bash
# åŸºæœ¬èª¿è©¦
DEBUG=1 npm run dev

# è©³ç´°èª¿è©¦
VITE_HTML_KIT_DEBUG=verbose npm run dev
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä½
**é ä¼°æ™‚é–“**: 4 å°æ™‚

---

### 14. å®‰å…¨æ€§é ­éƒ¨æ”¯æ´

**å•é¡Œ**
ç•¶å‰æ²’æœ‰ Content Security Policy (CSP) ç›¸é—œé…ç½®ã€‚

**è§£æ±ºæ–¹æ¡ˆ**
æ·»åŠ é¸é …æ”¯æ´æ³¨å…¥å®‰å…¨æ€§é ­éƒ¨ï¼š

```javascript
vitePluginHtmlKit({
  partialsDir: 'partials',
  data: {},

  // æ–°å¢ï¼šå®‰å…¨æ€§é…ç½®
  security: {
    // CSP é…ç½®
    csp: {
      'default-src': ["'self'"],
      'script-src': ["'self'", "'unsafe-inline'"],
      'style-src': ["'self'", "'unsafe-inline'"],
      'img-src': ["'self'", 'data:', 'https:'],
    },

    // è‡ªå‹•æ·»åŠ  nonce åˆ° inline scripts
    autoNonce: true
  }
})
```

**å¯¦ä½œ**:
```javascript
transformIndexHtml(html, ctx) {
  // ... åŸæœ‰é‚è¼¯ ...

  if (options.security?.autoNonce) {
    // ç”Ÿæˆ nonce
    const nonce = crypto.randomBytes(16).toString('base64');

    // æ·»åŠ åˆ° inline scripts
    html = html.replace(
      /<script(?![^>]*src=)/gi,
      `<script nonce="${nonce}"`
    );

    // æ·»åŠ  CSP meta tag
    const cspContent = buildCSPString({
      ...options.security.csp,
      'script-src': [...options.security.csp['script-src'], `'nonce-${nonce}'`]
    });

    html = html.replace(
      '</head>',
      `  <meta http-equiv="Content-Security-Policy" content="${cspContent}">\n</head>`
    );
  }

  return html;
}
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä½
**é ä¼°æ™‚é–“**: 1 å¤©

---

### 15. æ”¯æ´è‡ªè¨‚èªæ³•

**å•é¡Œ**
ç•¶å‰èªæ³•å›ºå®šç‚º `@if`, `@foreach` ç­‰ï¼Œç„¡æ³•è‡ªè¨‚ã€‚

**è§£æ±ºæ–¹æ¡ˆ**
å…è¨±ç”¨æˆ¶è‡ªè¨‚èªæ³•æ¨™è¨˜ï¼š

```javascript
vitePluginHtmlKit({
  partialsDir: 'partials',

  // æ–°å¢ï¼šè‡ªè¨‚èªæ³•é…ç½®
  syntax: {
    if: '@if',           // å¯æ”¹ç‚º '#if', '{{#if}}' ç­‰
    elseif: '@elseif',
    else: '@else',
    endif: '@endif',

    foreach: '@foreach', // å¯æ”¹ç‚º '@each', '#each' ç­‰
    endforeach: '@endforeach',

    switch: '@switch',
    case: '@case',
    default: '@default',
    endswitch: '@endswitch',

    // ä¹Ÿå¯ä»¥å®Œå…¨ä½¿ç”¨ä¸åŒé¢¨æ ¼
    // ä¾‹å¦‚ Handlebars é¢¨æ ¼: {{#if}}, {{/if}}
  }
})
```

**å¯¦ä½œ**:
```javascript
const buildRegexPatterns = (syntax) => {
  return {
    IF: new RegExp(`${escapeRegex(syntax.if)}\\s*\\((.*?)\\)`, 'gi'),
    ELSEIF: new RegExp(`${escapeRegex(syntax.elseif)}\\s*\\((.*?)\\)`, 'gi'),
    ELSE: new RegExp(escapeRegex(syntax.else), 'gi'),
    ENDIF: new RegExp(escapeRegex(syntax.endif), 'gi'),
    // ... å…¶ä»–èªæ³•
  };
};

export default function vitePluginHtmlKit(options = {}) {
  const syntax = {
    if: '@if',
    elseif: '@elseif',
    // ... é è¨­å€¼
    ...options.syntax
  };

  const REGEX = buildRegexPatterns(syntax);

  // ... å…¶é¤˜é‚è¼¯
}
```

**å„ªå…ˆç´š**: ğŸŸ¢ ä½
**é ä¼°æ™‚é–“**: 1 å¤©

---

## ğŸ“¦ ç™¼å¸ƒæº–å‚™

### 16. npm ç™¼å¸ƒæ¸…å–®æª¢æŸ¥

**ç™¼å¸ƒå‰æª¢æŸ¥é …ç›®**:

- [ ] **package.json æ­£ç¢ºæ€§**
  - [ ] `name` å”¯ä¸€ä¸”æœªè¢«ä½”ç”¨
  - [ ] `version` éµå¾ª Semantic Versioning
  - [ ] `description` æ¸…æ™°æ˜ç¢º
  - [ ] `keywords` å®Œæ•´
  - [ ] `repository`, `bugs`, `homepage` æ­£ç¢º
  - [ ] `files` æ¬„ä½åŒ…å«æ‰€æœ‰å¿…è¦æª”æ¡ˆ
  - [ ] `main`, `module`, `types` è·¯å¾‘æ­£ç¢º

- [ ] **æ–‡ä»¶å®Œæ•´æ€§**
  - [ ] README.md å®Œæ•´ä¸”æ¸…æ™°
  - [ ] LICENSE æ–‡ä»¶å­˜åœ¨
  - [ ] CHANGELOG.md è¨˜éŒ„æ‰€æœ‰è®Šæ›´
  - [ ] ç¯„ä¾‹ä»£ç¢¼å¯åŸ·è¡Œ

- [ ] **ä»£ç¢¼å“è³ª**
  - [ ] æ‰€æœ‰æ¸¬è©¦é€šé
  - [ ] æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%
  - [ ] ç„¡ ESLint éŒ¯èª¤
  - [ ] ä»£ç¢¼æ ¼å¼åŒ–ï¼ˆPrettierï¼‰

- [ ] **åŠŸèƒ½é©—è­‰**
  - [ ] playground æ­£å¸¸é‹ä½œ
  - [ ] åœ¨çœŸå¯¦å°ˆæ¡ˆä¸­æ¸¬è©¦
  - [ ] å¤šç¨® Node ç‰ˆæœ¬æ¸¬è©¦ (14, 16, 18, 20)
  - [ ] å¤šç¨® Vite ç‰ˆæœ¬æ¸¬è©¦ (3, 4, 5, 6, 7)

**æª¢æŸ¥æŒ‡ä»¤**:
```bash
# 1. æª¢æŸ¥æ‰“åŒ…å…§å®¹
npm pack --dry-run

# 2. æœ¬åœ°å®‰è£æ¸¬è©¦
npm pack
cd /tmp/test-project
npm install /path/to/vite-plugin-html-kit-0.0.1.tgz

# 3. æª¢æŸ¥ bundle å¤§å°
npm run build
ls -lh dist/
```

**.npmignore** (æ’é™¤ä¸å¿…è¦çš„æª”æ¡ˆ):
```
# é–‹ç™¼æª”æ¡ˆ
playground/
tests/
.github/
.vscode/

# é…ç½®æª”æ¡ˆ
.editorconfig
.eslintrc.cjs
.prettierrc
æ”¹å–„è¨ˆåŠƒ.md
æ”¹å–„è¨ˆåŠƒ-v2.md

# Git
.git
.gitignore

# Node
node_modules/
npm-debug.log*

# IDE
.idea/
*.swp
*.swo
```

**ç™¼å¸ƒæŒ‡ä»¤**:
```bash
# 1. ç¢ºä¿åœ¨æ­£ç¢ºçš„åˆ†æ”¯
git checkout main

# 2. æ›´æ–°ç‰ˆæœ¬è™Ÿ
npm version patch  # 0.0.1 -> 0.0.2
# or
npm version minor  # 0.0.1 -> 0.1.0
# or
npm version major  # 0.0.1 -> 1.0.0

# 3. æ¨é€æ¨™ç±¤
git push --follow-tags

# 4. ç™¼å¸ƒåˆ° npm
npm publish

# 5. å‰µå»º GitHub Release
gh release create v0.0.1 --notes "First release"
```

**å„ªå…ˆç´š**: ğŸ“¦ ç™¼å¸ƒå‰
**é ä¼°æ™‚é–“**: 2 å°æ™‚

---

### 17. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

**å•é¡Œ**
æ‰‹å‹•ç®¡ç†ç‰ˆæœ¬è™Ÿå®¹æ˜“å‡ºéŒ¯ï¼ŒCHANGELOG å®¹æ˜“éºæ¼ã€‚

**è§£æ±ºæ–¹æ¡ˆ A: ä½¿ç”¨ standard-version**
```bash
npm install -D standard-version
```

`package.json`:
```json
{
  "scripts": {
    "release": "standard-version",
    "release:minor": "standard-version --release-as minor",
    "release:major": "standard-version --release-as major"
  }
}
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
# è‡ªå‹•åˆ¤æ–·ç‰ˆæœ¬è™Ÿä¸¦ç”Ÿæˆ CHANGELOG
npm run release

# ç™¼å¸ƒ minor ç‰ˆæœ¬
npm run release:minor

# ç™¼å¸ƒ major ç‰ˆæœ¬
npm run release:major
```

**è§£æ±ºæ–¹æ¡ˆ B: ä½¿ç”¨ semantic-release** (æ›´è‡ªå‹•åŒ–)
```bash
npm install -D semantic-release @semantic-release/changelog @semantic-release/git
```

`.releaserc.json`:
```json
{
  "branches": ["main"],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    "@semantic-release/npm",
    "@semantic-release/git",
    "@semantic-release/github"
  ]
}
```

**Commit Message è¦ç¯„** (Conventional Commits):
```
feat: æ–°å¢åŠŸèƒ½
fix: ä¿®å¾© bug
docs: æ–‡ä»¶è®Šæ›´
style: ä»£ç¢¼æ ¼å¼ï¼ˆä¸å½±éŸ¿ä»£ç¢¼é‹è¡Œï¼‰
refactor: é‡æ§‹
perf: æ€§èƒ½å„ªåŒ–
test: æ¸¬è©¦ç›¸é—œ
chore: å»ºæ§‹éç¨‹æˆ–è¼”åŠ©å·¥å…·è®Šå‹•

ç¯„ä¾‹:
feat: æ·»åŠ è‡ªè¨‚èªæ³•æ”¯æ´
fix: ä¿®å¾©å¾ªç’°å¼•ç”¨æœªæª¢æ¸¬çš„å•é¡Œ
docs: æ›´æ–° README å®‰è£èªªæ˜
```

**å„ªå…ˆç´š**: ğŸ“¦ ç™¼å¸ƒå‰
**é ä¼°æ™‚é–“**: 1 å°æ™‚

---

## ğŸ“… å¯¦æ–½æ™‚ç¨‹è¦åŠƒ

### ç¬¬ä¸€éšæ®µï¼šç™¼å¸ƒæº–å‚™ ~~(Week 1-2)~~ (é€²è¡Œä¸­)
**ç›®æ¨™**: æº–å‚™ v0.1.0 ç™¼å¸ƒ

- [x] ~~æ·»åŠ  LICENSE æ–‡ä»¶~~ âœ… å·²å®Œæˆ
- [x] ~~æ·»åŠ  TypeScript é¡å‹å®šç¾©~~ âœ… å·²å®Œæˆ
- [x] ~~ä¿®å¾©å…¶ä»–è®Šé«”æª”æ¡ˆå®‰å…¨æ¼æ´~~ âœ… å·²å®Œæˆ
- [ ] å®Œå–„ package.json å…ƒæ•¸æ“š
- [ ] npm ç™¼å¸ƒæ¸…å–®æª¢æŸ¥

**é ä¼°æ™‚é–“**: ~~4-6 å°æ™‚~~ (å‰©é¤˜ 30 åˆ†é˜)

---

### ç¬¬äºŒéšæ®µï¼šå“è³ªæå‡ (Week 3-4)
**ç›®æ¨™**: æå‡ä»£ç¢¼å“è³ªå’Œæ–‡æª”

- [ ] æ·»åŠ è‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆç›®æ¨™è¦†è“‹ç‡ 80%ï¼‰
- [ ] å®Œå–„ README æ–‡æª”
- [ ] æ·»åŠ  CHANGELOG.md
- [ ] å»ºç«‹ CI/CD æµç¨‹
- [ ] é–‹ç™¼å·¥å…·é…ç½®æ¨™æº–åŒ–

**é ä¼°æ™‚é–“**: 2-3 å¤©

---

### ç¬¬ä¸‰éšæ®µï¼šåŠŸèƒ½å¢å¼· (Month 2)
**ç›®æ¨™**: æ·»åŠ é€²éšåŠŸèƒ½

- [ ] å¾ªç’°å¼•ç”¨æª¢æ¸¬
- [ ] æ€§èƒ½å„ªåŒ–ï¼ˆå¿«å–æ©Ÿåˆ¶ï¼‰
- [ ] æ“´å±• Debug æ¨¡å¼
- [ ] å¯¦ä½œ Slots/Stacks åŠŸèƒ½ï¼ˆåŸæ”¹å–„è¨ˆåŠƒï¼‰

**é ä¼°æ™‚é–“**: 1 é€±

---

### ç¬¬å››éšæ®µï¼šé•·æœŸå„ªåŒ– (Month 3+)
**ç›®æ¨™**: æŒçºŒæ”¹é€²

- [ ] Source Maps æ”¯æ´
- [ ] å®‰å…¨æ€§é ­éƒ¨æ”¯æ´
- [ ] è‡ªè¨‚èªæ³•æ”¯æ´
- [ ] æ›´å¤šç¯„ä¾‹å’Œæ–‡æª”

**é ä¼°æ™‚é–“**: æŒçºŒé€²è¡Œ

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### ä»£ç¢¼å“è³ªæŒ‡æ¨™
- âœ… æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%
- âœ… ç„¡ ESLint éŒ¯èª¤
- âœ… æ‰€æœ‰ CI æ¸¬è©¦é€šé
- âœ… ç„¡å·²çŸ¥å®‰å…¨æ¼æ´

### æ–‡æª”å“è³ªæŒ‡æ¨™
- âœ… README å®Œæ•´åº¦ â‰¥ 90%
- âœ… æ‰€æœ‰å…¬é–‹ API æœ‰ JSDoc
- âœ… æœ‰å¯¦éš›ä½¿ç”¨ç¯„ä¾‹
- âœ… æœ‰æ•…éšœæ’é™¤æŒ‡å—

### ç¤¾ç¾¤æŒ‡æ¨™
- ğŸ¯ GitHub Stars > 50
- ğŸ¯ npm æ¯é€±ä¸‹è¼‰ > 100
- ğŸ¯ Issues å›æ‡‰æ™‚é–“ < 48 å°æ™‚
- ğŸ¯ è‡³å°‘ 3 å€‹å¤–éƒ¨è²¢ç»è€…

---

## ğŸ“ è¯çµ¡èˆ‡åé¥‹

å¦‚æœ‰ä»»ä½•å»ºè­°æˆ–å•é¡Œï¼Œæ­¡è¿ï¼š
- ğŸ“§ æäº¤ GitHub Issue
- ğŸ’¬ åƒèˆ‡ GitHub Discussions
- ğŸ› æäº¤ Pull Request

---

**æ–‡ä»¶ç‰ˆæœ¬**: v2.0
**æœ€å¾Œæ›´æ–°**: 2026-01-15
**ç¶­è­·è€…**: Denny (@dennykuo)
